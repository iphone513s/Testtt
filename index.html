<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æ ¡åœ’å°å¹«æ‰‹ | Campus Link Pro</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            50: '#eef2ff',
                            100: '#e0e7ff',
                            500: '#6366f1',
                            600: '#4F46E5',
                            700: '#4338ca',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    boxShadow: {
                        'up': '0 -4px 20px -5px rgba(0, 0, 0, 0.1)',
                    }
                }
            }
        }
    </script>

    <style>
        /* éš±è—æ»¾å‹•æ¢ */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .active-press:active { transform: scale(0.98); transition: transform 0.1s; }
        
        /* iOS Safe Area é©é… */
        .pb-safe { padding-bottom: calc(90px + env(safe-area-inset-bottom)); } /* å¢åŠ åº•éƒ¨ç©ºé–“é˜²æ­¢é®æ“‹ */
        .pt-safe { padding-top: env(safe-area-inset-top); }
        
        /* åœ°åœ–æ¨¡æ“¬ */
        .map-bg-1 { background: #e5e7eb url('https://placehold.co/600x400/e5e7eb/a3a3a3?text=Campus+Map+A') center/cover; }
        .map-bg-2 { background: #e5e7eb url('https://placehold.co/600x400/d1d5db/6b7280?text=Campus+Map+B') center/cover; }
        .map-bg-3 { background: #e5e7eb url('https://placehold.co/600x400/f3f4f6/9ca3af?text=Gym+Zone') center/cover; }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 font-sans h-screen w-screen overflow-hidden flex flex-col select-none">

    <main id="app-container" class="flex-1 overflow-y-auto no-scrollbar relative w-full scroll-smooth">
        
        <section id="page-home" class="page-section min-h-full pb-safe">
            <div class="sticky top-0 bg-white/95 backdrop-blur-md z-30 px-4 pt-safe shadow-sm pb-3">
                <div class="flex justify-between items-center py-2">
                    <div class="flex items-center gap-2 bg-gray-100 px-3 py-1.5 rounded-full active:bg-gray-200 transition">
                        <i data-lucide="map-pin" class="w-4 h-4 text-brand-600"></i>
                        <select onchange="refreshTasks(this.value)" class="bg-transparent text-sm font-bold text-gray-700 outline-none pr-1">
                            <option value="TKU">æ·¡æ±Ÿå¤§å­¸ (ç›®å‰)</option>
                            <option value="NTU">å°ç£å¤§å­¸</option>
                            <option value="NCCU">æ”¿æ²»å¤§å­¸</option>
                            <option value="Other">å…¶ä»–æ ¡å€...</option>
                        </select>
                    </div>
                    <div class="relative p-2 active:bg-gray-100 rounded-full">
                        <i data-lucide="bell" class="w-6 h-6 text-gray-600"></i>
                        <span class="absolute top-1 right-2 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-white"></span>
                    </div>
                </div>

                <div class="flex gap-3 overflow-x-auto no-scrollbar mt-1 pb-1" id="task-tabs">
                    <button onclick="filterTasks('all', this)" class="tab-btn active px-4 py-1.5 bg-brand-600 text-white text-sm font-medium rounded-full shadow-md whitespace-nowrap transition-all">å…¨éƒ¨</button>
                    <button onclick="filterTasks('food', this)" class="tab-btn px-4 py-1.5 bg-white text-gray-600 text-sm font-medium rounded-full border border-gray-200 whitespace-nowrap transition-all">ğŸ” è·‘è…¿è²·é£¯</button>
                    <button onclick="filterTasks('study', this)" class="tab-btn px-4 py-1.5 bg-white text-gray-600 text-sm font-medium rounded-full border border-gray-200 whitespace-nowrap transition-all">ğŸ“š å…±ç­†/ä½”ä½</button>
                    <button onclick="filterTasks('multi', this)" class="tab-btn px-4 py-1.5 bg-white text-brand-600 text-sm font-medium rounded-full border border-brand-200 whitespace-nowrap transition-all">ğŸ‘¥ å¤šäººçµ„éšŠ</button>
                </div>
            </div>

            <div class="p-4 space-y-4" id="task-list">
                </div>
        </section>

        <section id="page-post" class="page-section hidden h-full bg-white flex flex-col z-40 fixed inset-0">
            <header class="p-4 border-b border-gray-100 bg-white pt-safe flex items-center justify-between">
                <h2 class="text-xl font-bold">ç™¼å¸ƒæ–°å§”è¨—</h2>
                <button onclick="switchTab('home')" class="p-2 text-gray-400 hover:text-gray-600"><i data-lucide="x" class="w-6 h-6"></i></button>
            </header>
            
            <div class="flex-1 overflow-y-auto p-5 pb-40"> 
                <div class="space-y-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">ä»»å‹™æ¨¡å¼</label>
                    <div class="grid grid-cols-2 gap-4">
                        <div onclick="selectPostMode('single')" id="btn-mode-single" class="cursor-pointer p-4 border-2 border-brand-600 bg-brand-50 rounded-xl flex flex-col items-center justify-center text-brand-700 transition-all active:scale-95">
                            <i data-lucide="user" class="w-6 h-6 mb-1"></i>
                            <span class="font-bold">å–®äººä»»å‹™</span>
                        </div>
                        <div onclick="selectPostMode('multi')" id="btn-mode-multi" class="cursor-pointer p-4 border border-gray-200 bg-white rounded-xl flex flex-col items-center justify-center text-gray-400 transition-all active:scale-95">
                            <i data-lucide="users" class="w-6 h-6 mb-1"></i>
                            <span class="font-medium">å¤šäººå”ä½œ</span>
                        </div>
                    </div>

                    <div id="multi-options" class="hidden bg-gray-50 p-4 rounded-xl border border-gray-200">
                        <label class="block text-sm text-gray-600 mb-2">éœ€è¦äººæ•¸</label>
                        <div class="flex items-center gap-4">
                            <button onclick="adjustPeople(-1)" class="w-8 h-8 rounded-full bg-white border flex items-center justify-center">-</button>
                            <span class="font-bold text-lg" id="people-count">2</span>
                            <button onclick="adjustPeople(1)" class="w-8 h-8 rounded-full bg-white border flex items-center justify-center">+</button>
                            <span class="text-sm text-gray-400">äºº</span>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ä»»å‹™æ¨™é¡Œ</label>
                        <input type="text" id="post-title" placeholder="ä¾‹å¦‚ï¼šå¹«å¿™æ¬ç³»è¾¦æ²™ç™¼" class="w-full p-4 bg-gray-50 rounded-xl outline-none focus:ring-2 focus:ring-brand-500 transition border border-transparent focus:bg-white">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">åœ°é» (è‡ªå‹•å®šä½)</label>
                        <div class="relative">
                            <i data-lucide="map-pin" class="absolute left-4 top-4 w-5 h-5 text-brand-500"></i>
                            <input type="text" id="post-loc" value="æ·¡æ±Ÿå¤§å­¸ å·¥å­¸é¤¨" class="w-full p-4 pl-12 bg-gray-50 rounded-xl outline-none">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">é¡˜ä»˜é‡‘é¡ (æ¯äºº)</label>
                        <div class="relative">
                            <span class="absolute left-4 top-4 text-gray-500">$</span>
                            <input type="number" value="150" id="base-price" class="w-full p-4 pl-8 bg-gray-50 rounded-xl outline-none font-bold text-lg">
                        </div>
                    </div>

                    <div class="bg-red-50 border border-red-100 p-4 rounded-xl flex items-center justify-between">
                        <div>
                            <div class="flex items-center gap-2">
                                <h3 class="font-bold text-red-700">ğŸ”¥ æ€¥ä»¶ç½®é ‚</h3>
                                <span class="text-xs bg-red-200 text-red-800 px-1 rounded">HOT</span>
                            </div>
                            <p class="text-xs text-red-400 mt-1">å¢åŠ  300% æ›å…‰ç‡</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="urgent-toggle" class="sr-only peer" onchange="updateTotal()">
                            <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-500"></div>
                        </label>
                    </div>
                </div>
            </div>

            <div class="absolute bottom-0 left-0 w-full bg-white border-t border-gray-100 p-4 pb-8 shadow-up z-50">
                <div class="flex justify-between items-end mb-3 px-1">
                    <span class="text-gray-500 text-sm">é ä¼°ç¸½é¡</span>
                    <span class="text-2xl font-bold text-gray-900" id="total-price">$150</span>
                </div>
                <button onclick="submitTask()" class="w-full bg-brand-600 text-white font-bold py-4 rounded-xl shadow-lg active:scale-95 transition-transform hover:bg-brand-700">
                    ç«‹å³ç™¼å¸ƒ
                </button>
            </div>
        </section>

        <section id="page-tasks" class="page-section hidden min-h-full p-4 pb-safe pt-safe">
            <h2 class="text-2xl font-bold text-gray-900 mb-6 mt-4">è¨‚å–®ç®¡ç†</h2>
            <div class="flex border-b border-gray-200 mb-4">
                <div class="pb-2 border-b-2 border-brand-600 text-brand-600 font-medium px-4 cursor-pointer">æˆ‘ç™¼å¸ƒçš„</div>
                <div class="pb-2 text-gray-400 font-medium px-4 cursor-pointer">æ­·å²ç´€éŒ„</div>
            </div>
            
            <div id="my-posted-list" class="space-y-3">
                <div class="text-center mt-20 opacity-50" id="empty-state">
                    <i data-lucide="clipboard-list" class="w-16 h-16 mx-auto mb-2 text-gray-300"></i>
                    <p>ç›®å‰æ²’æœ‰é€²è¡Œä¸­çš„ä»»å‹™</p>
                </div>
            </div>
        </section>

        <section id="page-profile" class="page-section hidden min-h-full bg-gray-50 pb-safe">
            <div class="bg-white pb-6 pt-safe px-5 rounded-b-3xl shadow-sm mb-4">
                <div class="flex items-center gap-4 mt-4">
                    <div class="w-20 h-20 bg-gradient-to-tr from-brand-400 to-blue-300 rounded-full border-4 border-white shadow-md flex items-center justify-center text-white text-2xl font-bold">
                        æ˜
                    </div>
                    <div>
                        <h2 class="text-xl font-bold text-gray-900">å°æ˜</h2>
                        <div class="flex items-center gap-2 mt-1">
                            <span class="bg-gray-100 text-gray-600 text-xs px-2 py-0.5 rounded">è³‡ç®¡ç³» 3A</span>
                            <span class="text-yellow-500 text-sm font-bold flex items-center"><i data-lucide="star" class="w-3 h-3 fill-current mr-1"></i>4.9</span>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-3 mt-6">
                    <div class="bg-gray-50 p-3 rounded-xl border border-gray-100 text-center">
                        <span class="text-gray-400 text-xs">éŒ¢åŒ…é¤˜é¡</span>
                        <span class="text-xl font-bold text-gray-900 block mt-1">$520</span>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-xl border border-gray-100 text-center">
                        <span class="text-gray-400 text-xs">ä¿¡ç”¨åˆ†æ•¸</span>
                        <span class="text-xl font-bold text-green-600 block mt-1">100</span>
                    </div>
                </div>
            </div>
            
            <div class="px-4 space-y-2">
                <div class="bg-white p-4 rounded-xl flex justify-between items-center shadow-sm active-press">
                    <span class="font-medium text-gray-700">æ­·å²è©•åƒ¹</span>
                    <i data-lucide="chevron-right" class="w-5 h-5 text-gray-300"></i>
                </div>
                <div class="bg-white p-4 rounded-xl flex justify-between items-center shadow-sm active-press">
                    <span class="font-medium text-gray-700">ä»˜æ¬¾è¨­å®š</span>
                    <i data-lucide="chevron-right" class="w-5 h-5 text-gray-300"></i>
                </div>
            </div>
        </section>

    </main>

    <nav class="bg-white border-t border-gray-100 flex justify-around items-center h-[85px] z-50 fixed bottom-0 w-full pb-6 shadow-[0_-5px_15px_rgba(0,0,0,0.02)]">
        <button onclick="switchTab('home')" class="nav-btn text-brand-600 flex flex-col items-center gap-1 w-16 pt-2" id="nav-home">
            <i data-lucide="home" class="w-6 h-6"></i>
            <span class="text-[10px] font-medium">å¤§å»³</span>
        </button>
        <button onclick="switchTab('post')" class="nav-btn text-gray-400 flex flex-col items-center gap-1 w-16 pt-2" id="nav-post">
            <div class="bg-brand-600 text-white p-3 rounded-full -mt-10 shadow-lg border-4 border-gray-50 active:scale-95 transition">
                <i data-lucide="plus" class="w-6 h-6"></i>
            </div>
            <span class="text-[10px] font-medium">ç™¼å¸ƒ</span>
        </button>
        <button onclick="switchTab('tasks')" class="nav-btn text-gray-400 flex flex-col items-center gap-1 w-16 pt-2" id="nav-tasks">
            <i data-lucide="clipboard-list" class="w-6 h-6"></i>
            <span class="text-[10px] font-medium">è¨‚å–®</span>
        </button>
        <button onclick="switchTab('profile')" class="nav-btn text-gray-400 flex flex-col items-center gap-1 w-16 pt-2" id="nav-profile">
            <i data-lucide="user" class="w-6 h-6"></i>
            <span class="text-[10px] font-medium">æˆ‘çš„</span>
        </button>
    </nav>

    <div id="modal-task" class="fixed inset-0 bg-black/40 z-[60] hidden flex flex-col justify-end opacity-0 transition-opacity duration-300">
        <div class="bg-white w-full h-[85vh] rounded-t-3xl flex flex-col transform translate-y-full transition-transform duration-300 shadow-2xl relative" id="modal-task-content">
            <button onclick="closeModal('modal-task')" class="absolute top-4 right-4 p-2 bg-gray-100 rounded-full z-10"><i data-lucide="x" class="w-5 h-5 text-gray-500"></i></button>
            
            <div class="flex-1 overflow-y-auto p-6 pb-24">
                <span class="px-2 py-1 rounded text-xs font-bold bg-gray-100 text-gray-600" id="detail-tag">æ¨™ç±¤</span>
                <h3 class="text-2xl font-bold mt-3 mb-1 text-gray-900 leading-tight" id="detail-title">æ¨™é¡Œ</h3>
                <div class="text-3xl font-bold text-brand-600 mb-6" id="detail-price">$150</div>

                <div onclick="openOtherProfile()" class="flex items-center justify-between bg-white border border-gray-100 shadow-sm p-4 rounded-xl mb-6 active:bg-gray-50 cursor-pointer">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center text-lg font-bold text-gray-600" id="detail-avatar">A</div>
                        <div>
                            <p class="font-bold text-gray-900 flex items-center gap-1">
                                <span id="detail-user">User</span>
                                <i data-lucide="chevron-right" class="w-3 h-3 text-gray-400"></i>
                            </p>
                            <div class="flex items-center gap-2 text-xs">
                                <span class="text-gray-500" id="detail-role">ç³»æ‰€</span>
                                <span class="flex items-center text-yellow-500 font-bold"><i data-lucide="star" class="w-3 h-3 fill-current mr-0.5"></i> 4.8</span>
                            </div>
                        </div>
                    </div>
                    <button onclick="event.stopPropagation(); openChat()" class="bg-brand-50 text-brand-700 px-4 py-2 rounded-lg text-sm font-bold">
                        ç§è¨Š
                    </button>
                </div>

                <div class="w-full h-40 rounded-xl mb-4 relative overflow-hidden bg-gray-100 shadow-inner" id="detail-map">
                    <div class="absolute inset-0 bg-black/10 flex items-center justify-center">
                        <span class="bg-white/90 px-3 py-1.5 rounded-full text-xs font-bold shadow flex items-center gap-1">
                            <i data-lucide="navigation" class="w-3 h-3 text-blue-500"></i>
                            è·é›¢ <span id="detail-dist">350m</span>
                        </span>
                    </div>
                </div>

                <div class="space-y-2 mb-6">
                    <h4 class="font-bold text-gray-900 text-sm">ä»»å‹™è©³æƒ…</h4>
                    <p class="text-gray-600 leading-relaxed text-sm" id="detail-desc">æè¿°...</p>
                </div>
            </div>

            <div class="p-4 border-t border-gray-100 bg-white pb-safe">
                <button id="btn-action" class="w-full bg-brand-600 text-white font-bold py-4 rounded-xl text-lg shadow-lg active:scale-95 transition">
                    æ¥ä¸‹ä»»å‹™
                </button>
            </div>
        </div>
    </div>

    <div id="modal-other-profile" class="fixed inset-0 bg-white z-[70] hidden flex flex-col animate-fade-in">
        <header class="p-4 pt-safe flex items-center gap-4 border-b border-gray-100">
            <button onclick="closeModal('modal-other-profile')" class="p-2 -ml-2"><i data-lucide="arrow-left" class="w-6 h-6"></i></button>
            <h2 class="font-bold text-lg">ç™¼å¸ƒè€…è³‡è¨Š</h2>
        </header>
        <div class="p-6 overflow-y-auto">
            <div class="text-center mb-6">
                <div class="w-20 h-20 bg-gray-200 rounded-full mx-auto mb-3 flex items-center justify-center text-2xl font-bold" id="profile-avatar-lg">A</div>
                <h3 class="text-xl font-bold" id="profile-name-lg">Alice</h3>
                <p class="text-gray-500 text-sm" id="profile-role-lg">è‹±æ–‡ç³»</p>
            </div>
            
            <div class="bg-gray-50 p-4 rounded-xl mb-6 text-center">
                <div class="text-3xl font-bold text-gray-900">4.8</div>
                <div class="flex justify-center text-yellow-400 my-1">
                    <i data-lucide="star" class="w-4 h-4 fill-current"></i>
                    <i data-lucide="star" class="w-4 h-4 fill-current"></i>
                    <i data-lucide="star" class="w-4 h-4 fill-current"></i>
                    <i data-lucide="star" class="w-4 h-4 fill-current"></i>
                    <i data-lucide="star" class="w-4 h-4 fill-current"></i>
                </div>
                <div class="text-xs text-gray-400">å…± 24 å‰‡è©•åƒ¹</div>
            </div>

            <h4 class="font-bold mb-3 text-sm text-gray-700">æœ€è¿‘è©•è«–</h4>
            <div class="space-y-3">
                <div class="bg-white border border-gray-100 p-3 rounded-xl shadow-sm">
                    <div class="flex justify-between mb-1">
                        <span class="font-bold text-xs text-gray-900">é™³åŒå­¸</span>
                        <span class="text-yellow-500 text-xs font-bold">5.0 â˜…</span>
                    </div>
                    <p class="text-sm text-gray-600">äººå¾ˆå¥½ï¼Œæºé€šé †åˆ©ï¼</p>
                </div>
                <div class="bg-white border border-gray-100 p-3 rounded-xl shadow-sm">
                    <div class="flex justify-between mb-1">
                        <span class="font-bold text-xs text-gray-900">ç‹åŒå­¸</span>
                        <span class="text-yellow-500 text-xs font-bold">4.5 â˜…</span>
                    </div>
                    <p class="text-sm text-gray-600">å›è¦†å¾ˆå¿«ï¼Œè¬è¬ã€‚</p>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-chat" class="fixed inset-0 bg-white z-[80] hidden flex flex-col">
        <div class="border-b border-gray-100 p-4 pt-safe flex items-center gap-3 bg-white shadow-sm z-10">
            <button onclick="closeChat()" class="p-1"><i data-lucide="chevron-left" class="w-6 h-6"></i></button>
            <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-xs font-bold" id="chat-avatar">A</div>
            <div>
                <h3 class="font-bold text-sm" id="chat-name">è‹±æ–‡ç³» Alice</h3>
                <p class="text-[10px] text-green-500 flex items-center gap-1">â— ç·šä¸Š</p>
            </div>
        </div>
        
        <div class="flex-1 bg-gray-50 p-4 space-y-4 overflow-y-auto" id="chat-body">
            <div class="flex justify-center"><span class="text-xs text-gray-400 bg-gray-100 px-2 py-1 rounded">ä»Šå¤© 14:20</span></div>
            
            <div class="flex justify-end">
                <div class="bg-brand-600 text-white p-3 rounded-2xl rounded-tr-none max-w-[85%] text-sm shadow-sm leading-relaxed">
                    ä½ å¥½ï¼Œæˆ‘æƒ³æ¥é€™å€‹ä»»å‹™ã€‚è«‹å•åŒ…è£¹å¾ˆå¤§å—ï¼Ÿæ©Ÿè»Šè¼‰å¾—ä¸‹å—ï¼Ÿ
                </div>
            </div>

            <div class="flex justify-start">
                <div class="bg-white border border-gray-200 p-3 rounded-2xl rounded-tl-none max-w-[85%] text-sm shadow-sm leading-relaxed text-gray-700">
                    ä½ å¥½ï¼åŒ…è£¹ä¸å¤§å–”ï¼Œå¤§æ¦‚åƒé‹ç›’é‚£æ¨£ï¼Œæ©Ÿè»Šè¸æ¿å¯ä»¥æ”¾ï¼è¬è¬ä½ ï½
                </div>
            </div>
        </div>

        <div class="p-3 bg-white border-t border-gray-100 pb-safe">
            <div class="flex gap-2">
                <input type="text" placeholder="å‚³é€è¨Šæ¯..." class="flex-1 bg-gray-100 rounded-full px-4 py-2 text-sm outline-none focus:ring-1 focus:ring-brand-500">
                <button class="bg-brand-600 text-white p-2 rounded-full w-10 h-10 flex items-center justify-center"><i data-lucide="send" class="w-5 h-5"></i></button>
            </div>
        </div>
    </div>

    <div id="modal-lobby" class="fixed inset-0 bg-gray-900 z-[70] hidden flex flex-col items-center justify-center text-white">
        <div class="bg-white/10 p-5 rounded-full mb-6 animate-pulse">
            <i data-lucide="users" class="w-12 h-12"></i>
        </div>
        <h2 class="text-2xl font-bold mb-2">ç­‰å¾…éšŠå‹åŠ å…¥...</h2>
        <p class="text-gray-400 mb-8" id="lobby-title">ä»»å‹™ï¼šæ¬é‹æ²™ç™¼</p>
        
        <div class="grid grid-cols-3 gap-6 w-full max-w-xs mb-10 px-4">
            <div class="flex flex-col items-center gap-2">
                <div class="w-16 h-16 rounded-full bg-brand-500 border-2 border-white flex items-center justify-center font-bold text-xl">æˆ‘</div>
                <span class="text-xs font-bold text-green-400">æº–å‚™å®Œæˆ</span>
            </div>
            <div class="flex flex-col items-center gap-2">
                <div class="w-16 h-16 rounded-full bg-blue-500 flex items-center justify-center font-bold text-xl">B</div>
                <span class="text-xs text-gray-400">ç‹åŒå­¸</span>
            </div>
            <div class="flex flex-col items-center gap-2 opacity-50">
                <div class="w-16 h-16 rounded-full border-2 border-dashed border-gray-500 flex items-center justify-center">?</div>
                <span class="text-xs text-gray-500">ç­‰å¾…ä¸­</span>
            </div>
        </div>

        <button onclick="closeModal('modal-lobby')" class="bg-red-500/80 px-8 py-3 rounded-full font-bold backdrop-blur-sm">é›¢é–‹æˆ¿é–“</button>
    </div>

    <script>
        lucide.createIcons();

        // è³‡æ–™åº«
        let tasksData = [
            { id: 1, type: 'food', title: 'ä»£è²·æ‘©æ–¯æ¼¢å ¡', price: 50, urgent: false, user: 'é™³åŒå­¸', role: 'è³‡å·¥ç³»', avatar: 'é™³', mapClass: 'map-bg-1', desc: 'é€åˆ°å•†ç®¡å¤§æ¨“ 3Fï¼Œåªè¦æ¼¢å ¡ä¸è¦é£²æ–™ã€‚', multi: false },
            { id: 2, type: 'study', title: 'æ€¥ï¼å¹«é ˜ç³»è¾¦åŒ…è£¹', price: 80, urgent: true, user: 'Alice', role: 'è‹±æ–‡ç³»', avatar: 'A', mapClass: 'map-bg-2', desc: 'ç³»è¾¦äº”é»é—œé–€ï¼Œè«‹å¹«æˆ‘æ‹¿å»å®¿èˆå¤§å»³æ”¾ã€‚', multi: false },
            { id: 3, type: 'multi', title: 'æ¬é‹ç³»è¾¦èˆŠæ²™ç™¼', price: 200, urgent: false, user: 'å¼µåŠ©æ•™', role: 'ç‰©ç†ç³»è¾¦', avatar: 'å¼µ', mapClass: 'map-bg-3', desc: 'éœ€è¦ 3 å€‹äººå¹«å¿™å¾ 3 æ¨“æ¬åˆ° 1 æ¨“å›æ”¶å ´ã€‚', multi: true },
        ];

        // æ¸²æŸ“åˆ—è¡¨
        function renderTasks(filter = 'all') {
            const container = document.getElementById('task-list');
            container.innerHTML = '';
            
            // æ’åºï¼šæ€¥ä»¶å„ªå…ˆï¼Œæ–°çš„åœ¨å¾Œ
            const sortedData = [...tasksData].sort((a, b) => (b.urgent ? 1 : 0) - (a.urgent ? 1 : 0));

            const filtered = sortedData.filter(t => filter === 'all' || t.type === filter || (filter === 'multi' && t.multi));
            
            filtered.forEach(t => {
                let badge = '';
                let borderClass = 'border-gray-100';
                if (t.urgent) {
                    badge = `<span class="absolute top-0 right-0 bg-red-500 text-white text-[10px] px-2 py-1 rounded-bl-lg font-bold z-10 shadow-sm">ğŸ”¥ æ€¥ä»¶</span>`;
                    borderClass = 'border-l-4 border-l-red-500 border-red-100 shadow-md';
                } else if (t.multi) {
                    badge = `<span class="absolute top-0 right-0 bg-brand-600 text-white text-[10px] px-2 py-1 rounded-bl-lg font-bold z-10 shadow-sm">ğŸ‘¥ å¤šäºº</span>`;
                    borderClass = 'border-l-4 border-l-brand-600 border-brand-100';
                }

                const card = `
                <div onclick="openTaskModal(${t.id})" class="bg-white p-4 rounded-2xl shadow-sm border ${borderClass} relative overflow-hidden active-press cursor-pointer mb-3">
                    ${badge}
                    <div class="flex justify-between items-start mb-2 mt-1">
                        <div class="flex items-center gap-2">
                            <span class="w-8 h-8 rounded-full bg-gray-100 text-xs flex items-center justify-center font-bold text-gray-700">${t.avatar}</span>
                            <span class="text-xs text-gray-500 font-medium">${t.role}</span>
                        </div>
                        <span class="text-xl font-bold ${t.urgent ? 'text-red-600' : 'text-gray-900'}">$${t.price}</span>
                    </div>
                    <h3 class="font-bold text-lg mb-1 text-gray-800">${t.title}</h3>
                    <p class="text-gray-400 text-xs flex items-center gap-1">
                        <i data-lucide="map-pin" class="w-3 h-3"></i> è·é›¢ 200m
                    </p>
                </div>`;
                container.innerHTML += card;
            });
            lucide.createIcons();
        }

        // ç™¼å¸ƒæ¨¡å¼åˆ‡æ›
        let currentMode = 'single';
        function selectPostMode(mode) {
            currentMode = mode;
            const btnSingle = document.getElementById('btn-mode-single');
            const btnMulti = document.getElementById('btn-mode-multi');
            const multiOpt = document.getElementById('multi-options');

            if (mode === 'single') {
                btnSingle.className = "cursor-pointer p-4 border-2 border-brand-600 bg-brand-50 rounded-xl flex flex-col items-center justify-center text-brand-700 transition-all";
                btnMulti.className = "cursor-pointer p-4 border border-gray-200 bg-white rounded-xl flex flex-col items-center justify-center text-gray-400 transition-all";
                multiOpt.classList.add('hidden');
            } else {
                btnSingle.className = "cursor-pointer p-4 border border-gray-200 bg-white rounded-xl flex flex-col items-center justify-center text-gray-400 transition-all";
                btnMulti.className = "cursor-pointer p-4 border-2 border-brand-600 bg-brand-50 rounded-xl flex flex-col items-center justify-center text-brand-700 transition-all";
                multiOpt.classList.remove('hidden');
            }
        }

        function adjustPeople(num) {
            const el = document.getElementById('people-count');
            let count = parseInt(el.innerText) + num;
            if (count < 2) count = 2;
            if (count > 10) count = 10;
            el.innerText = count;
        }

        // ç™¼å¸ƒä»»å‹™ (é‚è¼¯ä¿®æ­£ï¼šçœŸçš„æœƒæ–°å¢)
        function submitTask() {
            const title = document.getElementById('post-title').value;
            const price = parseInt(document.getElementById('base-price').value);
            const isUrgent = document.getElementById('urgent-toggle').checked;
            
            if (!title) { alert("è«‹è¼¸å…¥æ¨™é¡Œ"); return; }

            const newTask = {
                id: Date.now(),
                type: currentMode === 'multi' ? 'multi' : 'other',
                title: title,
                price: price + (isUrgent ? 50 : 0),
                urgent: isUrgent,
                user: 'æˆ‘ (å‰›å‰›)',
                role: 'è³‡ç®¡ç³»',
                avatar: 'æˆ‘',
                mapClass: 'map-bg-1',
                desc: 'é€™æ˜¯ä¸€å€‹æ–°ç™¼å¸ƒçš„ä»»å‹™...',
                multi: currentMode === 'multi'
            };

            // å­˜å…¥é™£åˆ— (æ’åœ¨æœ€å‰é¢)
            tasksData.unshift(newTask);
            
            // UI åé¥‹
            const btn = document.querySelector('#page-post button');
            const originalText = btn.innerText;
            btn.innerText = "ç™¼å¸ƒä¸­...";
            
            setTimeout(() => {
                btn.innerText = originalText;
                alert("ç™¼å¸ƒæˆåŠŸï¼å·²æ–°å¢è‡³å¤§å»³èˆ‡æˆ‘çš„è¨‚å–®ã€‚");
                
                // é‡ç½®ä¸¦è·³è½‰
                document.getElementById('post-title').value = '';
                switchTab('tasks'); 
                renderMyTasks(); // æ›´æ–°æˆ‘çš„è¨‚å–®é é¢
                renderTasks();   // æ›´æ–°é¦–é 
            }, 800);
        }

        // æ¸²æŸ“ã€Œæˆ‘ç™¼å¸ƒçš„ã€
        function renderMyTasks() {
            const container = document.getElementById('my-posted-list');
            const myTasks = tasksData.filter(t => t.avatar === 'æˆ‘');
            
            if (myTasks.length > 0) {
                document.getElementById('empty-state').classList.add('hidden');
                container.innerHTML = '';
                myTasks.forEach(t => {
                    container.innerHTML += `
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex justify-between items-center">
                            <div>
                                <h3 class="font-bold text-gray-900">${t.title}</h3>
                                <p class="text-xs text-gray-500">ç­‰å¾…æ¥å–®ä¸­...</p>
                            </div>
                            <span class="font-bold text-brand-600">$${t.price}</span>
                        </div>
                    `;
                });
            }
        }

        // é é¢åˆ‡æ›
        function switchTab(tabId) {
            document.querySelectorAll('.page-section').forEach(el => el.classList.add('hidden'));
            
            // ç‰¹æ®Šè™•ç† Post é é¢ (å®ƒæ˜¯ Modal å½¢å¼)
            if (tabId === 'post') {
                document.getElementById('page-post').classList.remove('hidden');
                return;
            } else {
                document.getElementById('page-post').classList.add('hidden');
                document.getElementById('page-' + tabId).classList.remove('hidden');
            }

            // å°è¦½åˆ—ç‹€æ…‹
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('text-brand-600');
                btn.classList.add('text-gray-400');
            });
            if (tabId !== 'post') {
                const btn = document.getElementById('nav-' + tabId);
                btn.classList.remove('text-gray-400');
                btn.classList.add('text-brand-600');
            }
            
            if (tabId === 'home') renderTasks();
            if (tabId === 'tasks') renderMyTasks();
        }

        // Modal ç›¸é—œ
        let currentTaskUser = {}; 
        
        function openTaskModal(id) {
            const task = tasksData.find(t => t.id === id);
            const modal = document.getElementById('modal-task');
            const content = document.getElementById('modal-task-content');
            
            currentTaskUser = { name: task.user, role: task.role, avatar: task.avatar }; // æš«å­˜çµ¦ Profile ç”¨

            document.getElementById('detail-title').innerText = task.title;
            document.getElementById('detail-price').innerText = `$${task.price}`;
            document.getElementById('detail-desc').innerText = task.desc;
            document.getElementById('detail-user').innerText = task.user;
            document.getElementById('detail-role').innerText = task.role;
            document.getElementById('detail-avatar').innerText = task.avatar;
            document.getElementById('detail-dist').innerText = (Math.random()*500 + 100).toFixed(0) + 'm';
            
            document.getElementById('detail-tag').innerText = task.urgent ? 'ğŸ”¥ æ€¥ä»¶' : (task.multi ? 'ğŸ‘¥ å¤šäºº' : 'ä¸€èˆ¬');
            
            // æŒ‰éˆ•é‚è¼¯
            const btn = document.getElementById('btn-action');
            if (task.multi) {
                btn.innerText = "åŠ å…¥å¤šäººæˆ¿é–“";
                btn.onclick = () => { closeModal('modal-task'); document.getElementById('modal-lobby').classList.remove('hidden'); };
                btn.className = "w-full bg-brand-600 text-white font-bold py-4 rounded-xl text-lg shadow-lg active:scale-95 transition";
            } else {
                btn.innerText = "æ¥ä¸‹ä»»å‹™";
                btn.onclick = () => { alert('æ¥å–®æˆåŠŸï¼è«‹å‰å¾€è¯çµ¡ç™¼æ¡ˆè€…ã€‚'); };
                btn.className = "w-full bg-gray-900 text-white font-bold py-4 rounded-xl text-lg shadow-lg active:scale-95 transition";
            }

            // æ›´æ–° Chat è³‡è¨Š
            document.getElementById('chat-name').innerText = task.role + ' ' + task.user;
            document.getElementById('chat-avatar').innerText = task.avatar;

            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                content.classList.remove('translate-y-full');
            }, 10);
        }

        function closeModal(id) {
            const modal = document.getElementById(id);
            const content = document.getElementById(id + '-content');
            if (content) content.classList.add('translate-y-full');
            else modal.classList.add('opacity-0');
            
            setTimeout(() => {
                modal.classList.add('hidden');
                modal.classList.remove('opacity-0');
                if (content) content.classList.remove('translate-y-full');
            }, 300);
        }

        function openOtherProfile() {
            const modal = document.getElementById('modal-other-profile');
            document.getElementById('profile-name-lg').innerText = currentTaskUser.name;
            document.getElementById('profile-role-lg').innerText = currentTaskUser.role;
            document.getElementById('profile-avatar-lg').innerText = currentTaskUser.avatar;
            
            modal.classList.remove('hidden');
        }

        function openChat() {
            closeModal('modal-task');
            document.getElementById('modal-chat').classList.remove('hidden');
        }
        function closeChat() {
            document.getElementById('modal-chat').classList.add('hidden');
        }

        function filterTasks(type, el) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('bg-brand-600', 'text-white', 'active');
                btn.classList.add('bg-white', 'text-gray-600');
            });
            el.classList.remove('bg-white', 'text-gray-600');
            el.classList.add('bg-brand-600', 'text-white');
            renderTasks(type);
        }

        function updateTotal() {
            const price = parseInt(document.getElementById('base-price').value) || 0;
            const isUrgent = document.getElementById('urgent-toggle').checked;
            document.getElementById('total-price').innerText = '$' + (price + (isUrgent ? 50 : 0));
        }

        // åˆå§‹åŒ–
        renderTasks();

    </script>
</body>
</html>
